<!DOCTYPE html>
<html>
<head>
    <title>Account Activity | AI Healthcare</title>

    <style>
        body {
            margin: 0;
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #0f4c75, #1b6ca8);
            color: #333;
        }

        
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 40px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .header-left,
        .header-right {
            width: 20%;
            display: flex;
            align-items: center;
        }

        .header-center {
            width: 60%;
            text-align: center;
        }

        .header-center h2 {
            margin: 0;
            color: #0f4c75;
        }

        .icon-btn {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .icon-btn svg {
            width: 100%;
            height: 100%;
            transition: transform 0.2s ease;
        }

        .icon-btn:hover svg {
            transform: scale(1.1);
        }

        
        .container {
            max-width: 1100px;
            margin: 40px auto;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 35px;
            border-radius: 18px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            animation: fadeUp 0.6s ease;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .count-box {
            font-size: 15px;
            margin-bottom: 20px;
            color: #444;
        }

        
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-bar input,
        .filter-bar select {
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        .filter-bar button {
            padding: 8px 18px;
            background: #0f4c75;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .filter-bar button:hover {
            background: #09324e;
        }

        
        .progress-section {
            margin-bottom: 40px;
            background: rgba(255,255,255,0.75);
            backdrop-filter: blur(6px);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .progress-title {
            text-align: center;
            margin-bottom: 15px;
        }

        .progress-title h3 {
            margin: 0;
            color: #0f4c75;
            font-size: 20px;
        }

        .progress-subtitle {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            font-size: 13px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 4px;
        }

        .chart-wrapper {
            width: 100%;
            height: 300px;
        }

        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        th, td {
            padding: 12px;
            text-align: center;
        }

        th {
            background: #0f4c75;
            color: white;
        }

        tr:nth-child(even) {
            background: #f2f2f2;
        }

        tr:hover {
            background: #e8f4ff;
        }

        .risk-high { color: #c0392b; font-weight: bold; }
        .risk-medium { color: #e67e22; font-weight: bold; }
        .risk-low { color: #27ae60; font-weight: bold; }

        .btn-download {
            padding: 6px 12px;
            background: #27ae60;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            font-size: 13px;
        }

        .btn-delete {
            padding: 6px 12px;
            background: #c0392b;
            color: white;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 13px;
        }

    </style>
</head>
<body>


<div class="header">

    
    <div class="header-left">
        <a href="/dashboard" class="icon-btn" title="Back to Dashboard">
            <svg viewBox="0 0 24 24">
                <path d="M15 18l-6-6 6-6"
                      stroke="#0f4c75"
                      stroke-width="2"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"/>
            </svg>
        </a>
    </div>

    
    <div class="header-center">
        <h2>Account Activity Log</h2>
    </div>

    <div class="header-right"></div>

</div>


<div class="container">

    <div class="count-box">
        Total Predictions: <b>{{ total_predictions }}</b>
    </div>

    
    <form method="get" class="filter-bar">
        <input type="text" name="search"
               placeholder="Search by disease..."
               value="{{ search }}">

        <select name="risk">
            <option value="">All Risk Levels</option>
            <option value="Low Risk" {% if risk_filter=="Low Risk" %}selected{% endif %}>Low Risk</option>
            <option value="Medium Risk" {% if risk_filter=="Medium Risk" %}selected{% endif %}>Medium Risk</option>
            <option value="High Risk" {% if risk_filter=="High Risk" %}selected{% endif %}>High Risk</option>
        </select>

        <button type="submit">Search / Filter</button>
    </form>

    {% if chart_labels %}
    <div class="progress-section">

        <div class="progress-title">
            <h3>ðŸ“Š Health Progress Overview</h3>
            <div class="progress-subtitle">
                Latest probability comparison with previous prediction
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background:#27ae60;"></div>
                Improved
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background:#c0392b;"></div>
                Worsened
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background:#3498db;"></div>
                First Record
            </div>
        </div>

        <div class="chart-wrapper">
            <canvas id="progressChart"></canvas>
        </div>

    </div>
    {% endif %}

    {% if predictions %}
    <table>
        <tr>
            <th>Date & Time</th>
            <th>Disease</th>
            <th>Risk</th>
            <th>Probability</th>
            <th>Download</th>
            <th>Delete</th>
        </tr>

        {% for p in predictions %}
        <tr>
            <td>{{ p.timestamp }}</td>
            <td>{{ p.disease_type.capitalize() }}</td>
            <td>
                {% if p.risk_level == "High Risk" %}
                    <span class="risk-high">{{ p.risk_level }}</span>
                {% elif p.risk_level == "Medium Risk" %}
                    <span class="risk-medium">{{ p.risk_level }}</span>
                {% else %}
                    <span class="risk-low">{{ p.risk_level }}</span>
                {% endif %}
            </td>
            <td>{{ (p.probability * 100) | round(2) }}%</td>
            <td>
                <a href="/download_pdf/{{ p.id }}" class="btn-download">Download</a>
            </td>
            <td>
                <form action="/delete_prediction/{{ p.id }}" method="post"
                      onsubmit="return confirm('Are you sure?');">
                    <button type="submit" class="btn-delete">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = {{ chart_labels | tojson }};
const values = {{ chart_values | tojson }};
const colors = {{ chart_colors | tojson }};

if (labels.length > 0) {
    new Chart(document.getElementById("progressChart"), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: colors,
                borderRadius: 10,
                barThickness: 60
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: { callback: value => value + "%" }
                }
            }
        }
    });
}
</script>

</body>
</html>
