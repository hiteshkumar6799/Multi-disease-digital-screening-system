<!DOCTYPE html>
<html>
<head>
    <title>AI Healthcare Screening | Result</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: "Segoe UI", Arial, sans-serif;
            background: #f2f6f9;
        }

        
        .header {
            background: #ffffff;
            padding: 18px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e0e6ed;
        }

        .header h2 {
            margin: 0;
            font-size: 20px;
            color: #1b4f72;
        }

        .back-icon svg {
            width: 24px;
            height: 24px;
            stroke: #1b4f72;
        }

        
        .container {
            max-width: 1150px;
            margin: 35px auto;
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 40px;
        }

        
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .badge.low {
            background: #e8f8f5;
            color: #1e8449;
        }

        .badge.medium {
            background: #fef5e7;
            color: #b9770e;
        }

        .badge.high {
            background: #fdecea;
            color: #c0392b;
        }

        .info-block {
            margin-top: 18px;
            font-size: 15px;
        }

        .info-block strong {
            display: block;
            margin-bottom: 4px;
            color: #34495e;
        }

        .explanation {
            background: #f7f9fb;
            padding: 15px;
            border-left: 4px solid #1b4f72;
            border-radius: 8px;
            margin-top: 18px;
            font-size: 14px;
        }

        
        .chart-card {
            background: #ffffff;
            border: 1px solid #e0e6ed;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .chart-wrapper {
            max-width: 280px;
            margin: auto;
        }

        
        .actions {
            margin-top: 30px;
            text-align: center;
        }

        .actions button {
            padding: 8px 18px;
            margin: 5px;
            border-radius: 6px;
            border: none;
            background: #1b4f72;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .actions button:hover {
            background: #154360;
        }

        
        .suggestion-toggle {
            margin-top: 25px;
            text-align: left;
        }

        .suggestion-panel {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.4s ease;
            background: #f7fbff;
            border-left: 4px solid #1b4f72;
            padding: 0 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .suggestion-panel.open {
            padding: 15px;
            max-height: 500px;
        }

        .disclaimer {
            margin-top: 25px;
            font-size: 12px;
            text-align: center;
            color: #7b241c;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <a href="/dashboard" class="back-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
        </svg>
    </a>

    <h2>Clinical Screening Result â€“ {{ disease.capitalize() }}</h2>

    <div style="font-size:13px;color:#566573;">
        Patient: {{ user }}
    </div>
</div>

<div class="container">

    <div class="grid">

        
        <div>

            {% if risk == "High Risk" %}
                <span class="badge high">HIGH RISK</span>
            {% elif risk == "Medium Risk" %}
                <span class="badge medium">MODERATE RISK</span>
            {% else %}
                <span class="badge low">LOW RISK</span>
            {% endif %}

            <div class="info-block">
                <strong>Risk Probability</strong>
                {{ probability }}%
            </div>

            <div class="info-block">
                <strong>Model Accuracy</strong>
                90.0%
            </div>

            <div class="info-block">
                <strong>Clinical Recommendation</strong>

                {% if risk == "High Risk" %}
                    Immediate medical consultation advised.
                {% elif risk == "Medium Risk" %}
                    Lifestyle modification and monitoring recommended.
                {% else %}
                    Continue maintaining healthy lifestyle.
                {% endif %}
            </div>

            {% if shap_explanation %}
            <div class="explanation">
                <strong>Clinical Explanation:</strong><br>
                {{ shap_explanation }}
            </div>
            {% endif %}

            
            <div class="suggestion-toggle">
                <button onclick="toggleSuggestions()">
                    View Clinical Health Advisory
                </button>

                <div id="suggestionPanel" class="suggestion-panel">
                    <strong>{{ health_suggestions.title }}</strong><br>
                    {{ health_suggestions.message }}

                    <ul>
                        {% for item in health_suggestions["items"] %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

        </div>

        
        {% if shap_data %}
        <div class="chart-card">
            <h4>Risk Contribution Analysis</h4>

            <div class="chart-wrapper">
                <canvas id="shapChart"></canvas>
            </div>
        </div>
        {% endif %}

    </div>

    
    <div class="actions">
        <a href="/download_pdf"><button>Download PDF Report</button></a>
        <a href="/download_excel"><button>Download Excel Report</button></a>
    </div>

    <div class="disclaimer">
        This AI system provides screening support only and does not replace professional medical diagnosis.
    </div>

</div>

<script>
function toggleSuggestions() {
    document.getElementById("suggestionPanel")
        .classList.toggle("open");
}
</script>

{% if shap_data %}
<script>
const shapData = {{ shap_data | tojson }};
const labels = Object.keys(shapData);
const values = Object.values(shapData);

new Chart(document.getElementById("shapChart"), {
    type: "pie",
    data: {
        labels: labels.map(l => l.replace("_"," ").toUpperCase()),
        datasets: [{
            data: values,
            backgroundColor: ["#1b4f72","#3498db","#5dade2","#85c1e9","#aed6f1"]
        }]
    },
    options: {
        responsive: true
    }
});
</script>
{% endif %}

</body>
</html>
